{
  "name": "Library â€“ Recipes List / Get Recipe",
  "nodes": [
    {
      "parameters": {
        "path": "recipes",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "446531ba-71a8-488e-b967-a845c47c0bf4",
      "name": "get_recipes",
      "webhookId": "3e38d144-dae7-439e-aa93-316d5cbb0a05"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "getAll",
        "projectId": "=code-a-cuisine-ba168",
        "database": "=(default)",
        "collection": "recipes"
      },
      "name": "db_firestore_list_recipes",
      "type": "n8n-nodes-base.googleFirebaseCloudFirestore",
      "position": [
        208,
        0
      ],
      "typeVersion": 1,
      "id": "bc329aef-067e-4d33-bede-f360ae23b675",
      "credentials": {
        "googleApi": {
          "id": "dWVOhrB3gWsDc7h1",
          "name": "Google Service Account account"
        }
      }
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "likes",
              "order": "descending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        400,
        0
      ],
      "id": "7d295120-1f7c-4dfa-a2ae-21fee3668487",
      "name": "sort_by_likes_desc"
    },
    {
      "parameters": {
        "jsCode": "const q = $node[\"get_recipes\"].json.query ?? {};\nconst limit = Math.max(1, Math.min(50, Number(q.limit ?? 20)));\nconst offset = Math.max(0, Number(q.offset ?? 0));\nconst all = $input.all();\nconst page = all.slice(offset, offset + limit);\nreturn page;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        0
      ],
      "id": "40f7e204-f980-49b5-a3b3-0d9ca3df9e37",
      "name": "page_limit_offset"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ff8054ac-3cd8-40a5-afd8-12e8f8dede35",
              "name": "status",
              "value": 200,
              "type": "number"
            },
            {
              "id": "170df21b-fc5e-42ef-bf4e-d13ff1506451",
              "name": "recipes",
              "value": "={{ \n  $input.all().map(item => {\n    const json = item.json;\n\n    const timeCategory = json.timeCategory ?? json.cookingTime ?? null;\n\n    return {\n      id: json._id ?? json.id,\n      title: json.title ?? 'Generated',\n      ingredientsUsed: json.ingredientsUsed ?? [],\n      servings: Number(json.servings ?? 2),\n      createdAt: json.createdAt ?? null,\n      likes: Number(json.likes ?? 0),\n      tags: json.tags ?? [],\n      missingBasics: json.missingBasics ?? [],\n      steps: json.steps ?? [],\n      stepTitles: json.stepTitles ?? [],\n      stepBodies: json.stepBodies ?? [],\n      energyKcal: json.energyKcal ?? 630,\n      proteinG: json.proteinG ?? 18,\n      fatG: json.fatG ?? 24,\n      carbsG: json.carbsG ?? 58,\n      helperTodos: json.helperTodos ?? [],\n      timeCategory,\n      cuisine: json.cuisine ?? null,\n      diet: json.diet ?? null,\n      helpersCount: json.helpersCount ?? null,\n    };\n  })\n  .sort((a, b) => (b.likes ?? 0) - (a.likes ?? 0))\n}}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        768,
        0
      ],
      "id": "eb2dea21-6d35-40ac-81a0-80d856897147",
      "name": "out_shape_response_200"
    }
  ],
  "pinData": {},
  "connections": {
    "get_recipes": {
      "main": [
        [
          {
            "node": "db_firestore_list_recipes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "db_firestore_list_recipes": {
      "main": [
        [
          {
            "node": "sort_by_likes_desc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sort_by_likes_desc": {
      "main": [
        [
          {
            "node": "page_limit_offset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "page_limit_offset": {
      "main": [
        [
          {
            "node": "out_shape_response_200",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "2cf2c1a0-021a-4431-9531-9295dab4f5c8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ad3f9d388f26bf32f1df50a58fda8b4ee6fae7e3c9a0e70df8c27bf65882f8d8"
  },
  "id": "VlpMsrlFCCUa9pimqihks",
  "tags": []
}